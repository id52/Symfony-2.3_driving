{% extends "AppBundle::admin.html.twig" %}

{% block content %}
    <h3>{{ 'admin.add_old_user_title'|trans }}</h3>
    <hr>

    {{ form_start(form) }}
        {{ form_errors(form) }}
        <fieldset>
            <legend>{{ 'profile_registr_data'|trans }}:</legend>
            {{ form_row(form.email) }}
            {{ form_row(form.plain_password) }}
        </fieldset>

        <fieldset>
            <legend>{{ 'profile_registr_data'|trans }}:</legend>
            {{ form_row(form.last_name) }}
            {{ form_row(form.first_name) }}
            {{ form_row(form.patronymic) }}
        </fieldset>

        <fieldset>
            <legend>{{ 'profile_phone_data'|trans }}:</legend>
            <div class="control-group{% if form.phone_mobile.vars.errors|length > 0 %} error{% endif %}">
                {{ form_label(form.phone_mobile) }}
                <div class="controls">
                    <div class="input-prepend">
                        <span class="add-on">+7</span>
                        {{ form_widget(form.phone_mobile, { attr: { class: 'span2' }}) }}
                    </div>
                    {{ form_errors(form.phone_mobile) }}
                </div>
            </div>
        </fieldset>

        <fieldset>
            <legend>{{ 'profile_additional_info'|trans }}:</legend>
            {{ form_row(form.region) }}
            {{ form_row(form.category) }}
            {{ form_row(form.paradox_id) }}
        </fieldset>

        <div class="form-actions">
            <div class="alert alert-info" role="alert" id="pay-amount-info">
            </div>
            <button id='submit_btn' type="submit" class="btn btn-success"><i class="fa fa-download"></i> {{ 'admin.buttons.create'|trans }}</button>

        </div>
    {{ form_end(form) }}
{% endblock content %}

{% block js %}
<script>
$(function() {
    var phoneMobile = $('#form_phone_mobile');
    phoneMobile.removeAttr('required');
    phoneMobile.attr('pattern', '\\(\\d{3}\\) \\d{3}-\\d{2}-\\d{2}');
    phoneMobile.inputmask('(999) 999-99-99', { clearMaskOnLostFocus: false, removeMaskOnSubmit:true });

    {% if user is not defined %}
    var regionTree = {{ region_tree|json_encode|raw }};

    var regionElement = $('#form_region');
    var categoryElement = $('#form_category');

    var updateCategories = function() {
        var region = regionElement.val();

        $('option', categoryElement).each(function () {
            var isSetProp = Boolean(
                regionTree[region]
                && regionTree[region]['cats'].hasOwnProperty(this.value)
            );
            $(this).toggle(this.value == '' || Boolean(isSetProp));
        });
    };
    updateCategories();

    regionElement.change(function() {
        categoryElement.val('');
        updateCategories();
    });

    {% endif %}

    var form = $('form');
    var inputs = $('form input');
    var submit_btn = $('#submit_btn');

    var onChangeForm = function onChangeForm() {
        submit_btn.removeAttr('disabled');
        $.each( inputs, function( i, input ) {
            if ($(input).val() == '') {
                submit_btn.attr('disabled', 'disabled');
            }
        });
    };

    form.on('change', onChangeForm);
    form.on('keyup', onChangeForm);
    onChangeForm();
});
</script>
{% endblock js %}
