{% extends "AppBundle::layout_new.html.twig" %}

{% form_theme form 'AppBundle::form_new.html.twig' %}

{% block start_content %}
<div id="modal-empty" class="modal border-red">
    <div class="notice bg-sad">
        <div class="title">ВЫ НЕ ВЫБРАЛИ ТЕМЫ</div>
        Чтобы начать тестирование необходимо выбрать хотя бы одну тему. Сумма вопросов в выбранных темах должна быть 20 или больше. Пример: “Применение специальных сигналов (7 вопросов)” содержит 7 вопросов, нужно добавить еще темы, что бы сумма вопросов была 20 или больше, добавляем тему “Общие обязанности водителей, пассажиров и пешеходов (13 вопросов), в итоге у нас получается 20 вопросов, можно начинать тестирование.  Вы можете выбрать интересующие Вас темы по отдельности или все темы сразу, нажав "Выбрать все". Снять выделение со всех тем можно нажав "Очистить".
    </div>
    <span class="close"></span>
</div>

<div id="modal-min" class="modal border-red">
    <div class="notice bg-sad">
        <div class="title">Вы выбрали темы которые содержат менее 20 вопросов</div>
        Для начала тестирования необходимо выбрать темы, в которых сумма вопросов будет 20 или больше.<br>
        <b>Пример:</b> «Применение специальных сигналов (7 вопросов)» содержит 7 вопросов, нужно добавить ещё темы, что бы сумма вопросов была 20 или больше. Добавляете тему «Общие обязанности водителей, пассажиров и пешеходов (13 вопросов)». В итоге выбрано 2 темы, которые в общей сложности содержат 20 вопросов. Теперь Вы можете начать тестирование.<br>
        Выбрать интересующие Вас темы по отдельности или все сразу, кликнув на текст «Выбрать всё». Снять выделение со всех тем можно кликнув на текст «Очистить».
    </div>
    <span class="close"></span>
</div>
{% endblock start_content %}

{% block content %}
<nav class="path">
    <a href="{{ path('homepage') }}">{{ 'titles.homepage'|trans }}</a>
    » <strong>{{ 'titles.test_knowledge'|trans }}</strong>
</nav>

<div class="mainContent">
    {% include 'AppBundle::_paid2_counter.html.twig' %}
    {% include 'AppBundle::_owe_stage_paid.html.twig' %}

    <section class="tickets knowledge">
        {{ form_start(form) }}
        {{ form_errors(form) }}
            <div class="title"><h1>{{ 'titles.test_knowledge'|trans }}</h1></div>

            {% if form.themes.vars.errors|length > 0 %}
                <div>
                    {{ form_errors(form.themes) }}
                </div>
            {% endif %}

            <ul class="list">
                {% for child in form.themes %}
                    <li>
                        <div class="hold">
                            {{ form_widget(child) }}
                        </div>
                        <label for="{{ child.vars.id }}"></label>
                        {{ child.vars.label }}
                    </li>
                {% endfor %}
            </ul>

            <div class="set">
                <div class="l">
                    <div class="check all">
                        <input class="customCheckbox" id="all" type="checkbox" value="">
                        <label for="all">Выбрать все</label>
                    </div>
                    <button type="reset" class="reset-form">Очистить</button>
                </div>

                <div class="r">
                    <div class="check">
                        {{ form_widget(form.comments) }}
                        {{ form_label(form.comments) }}
                    </div>
                    <div class="check">
                        {{ form_widget(form.time) }}
                        {{ form_label(form.time) }}
                    </div>
                </div>
            </div>

            <div class="links">
                <span class="link bg-green start-link">
                    {{- 'buttons.start'|trans }}
                    <input value="" type="submit">
                </span>
            </div>

        {{ form_end(form) }}
    </section>
</div>
{% endblock content %}

{% block js %}
<script>
$(function() {
    var themes_cnt = eval({{ themes_cnt|json_encode|raw }});
    $('.tickets form').submit(function() {
        var items = $('.list', $(this)).find(':checked');
        if (items.length) {
            var all = 0;
            items.each(function() {
                all += themes_cnt[$(this).val()];
            });
            if (all < 20) {
                $.simplebox('#modal-min');
                return false;
            }
        } else {
            $.simplebox('#modal-empty');
            return false;
        }
    });
});
</script>
{% endblock js %}
